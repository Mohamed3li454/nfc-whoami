<!doctype html>
<!--
  Single-file NFC landing page: index.html
  - One file (HTML + CSS + JS). Save as index.html and put the link on your NFC tag.
  - To customize: change CSS variables in :root (colors, font-family).
  - This page tries to detect device type, browser (including Chrome on iOS), OS (improved iOS/iPadOS detection),
    and fetches the public IP via https://api.ipify.org?format=json (mandatory on load).
  - No analytics, no external tracking. Only optional Google Font link (can remove).
-->
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Who am I</title>

  <!-- Google Font (optional) - remove or replace if you prefer local fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;800&display=swap" rel="stylesheet">

  <style>
    :root{
      --bg:#051017;
      --panel:#0b1116;
      --accent:#00e2bd;
      --muted:#9aa7b3;
      --glow: 0 10px 40px rgba(0,226,189,0.08);
      --glass: rgba(255,255,255,0.03);
      --font: "Inter", system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
    }

    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family:var(--font);
      background:
        radial-gradient(1200px 600px at 10% 10%, rgba(0,226,189,0.03), transparent 8%),
        radial-gradient(1000px 500px at 90% 90%, rgba(0,132,255,0.02), transparent 6%),
        var(--bg);
      color:#d6e7ee;
      -webkit-font-smoothing:antialiased;
      -moz-osx-font-smoothing:grayscale;
      display:flex;
      align-items:center;
      justify-content:center;
      padding:28px;
    }

    .card{
      width:100%;
      max-width:900px;
      border-radius:16px;
      padding:36px;
      background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
      box-shadow:var(--glow);
      backdrop-filter: blur(6px);
      border: 1px solid rgba(255,255,255,0.03);
      display:grid;
      gap:22px;
      align-items:center;
    }

    .center{
      text-align:center;
    }

    .who{
      font-size: clamp(36px, 9vw, 84px);
      font-weight:800;
      letter-spacing:0.02em;
      line-height:0.95;
      position:relative;
      display:inline-block;
    }

    /* typing cursor */
    .who .typing{
      display:inline-block;
      overflow:hidden;
      vertical-align:middle;
      white-space:nowrap;
    }
    .cursor{
      display:inline-block;
      width:6px;
      height:1.06em;
      background:var(--accent);
      margin-left:10px;
      border-radius:2px;
      opacity:0;
      transform: translateY(-2px);
      box-shadow: 0 0 12px rgba(0,226,189,0.8);
      animation: blink 1s steps(2,start) infinite, fadeIn 0.6s ease forwards;
    }
    @keyframes blink { 50%{opacity:0} 0%{opacity:1} 100%{opacity:1} }
    @keyframes fadeIn { from{opacity:0} to{opacity:1} }

    /* glitch effect layer */
    .who .glitch{
      position:absolute;
      left:0; top:0;
      right:0; bottom:0;
      pointer-events:none;
      mix-blend-mode:screen;
      opacity:0;
      animation: glitchIn 0.9s 1 forwards;
    }
    .who .glitch span{
      position:absolute;
      left:0; top:0;
      width:100%;
      transform-origin:center;
    }
    @keyframes glitchIn{
      0%{opacity:0}
      20%{opacity:1}
      100%{opacity:0.18}
    }
    @keyframes g1 { 0%{transform:translate(0,0)} 20%{transform:translate(-2px,-1px)} 40%{transform:translate(2px,1px)} 60%{transform:translate(-1px,1px)} 100%{transform:translate(0,0)} }
    @keyframes g2 { 0%{transform:translate(0,0)} 20%{transform:translate(2px,1px)} 40%{transform:translate(-2px,-1px)} 60%{transform:translate(1px,-1px)} 100%{transform:translate(0,0)} }

    .sub{
      margin-top:8px;
      color:var(--muted);
      font-weight:500;
      letter-spacing:0.03em;
    }

    .info-grid{
      display:grid;
      grid-template-columns: repeat(auto-fit, minmax(180px,1fr));
      gap:14px;
      margin-top:12px;
    }

    .info{
      background:linear-gradient(180deg, rgba(255,255,255,0.012), rgba(255,255,255,0.01));
      border-radius:12px;
      padding:12px;
      border:1px solid rgba(255,255,255,0.02);
      min-height:72px;
      display:flex;
      flex-direction:column;
      justify-content:center;
      transition:transform .22s ease, box-shadow .22s ease;
    }
    .info:hover{ transform: translateY(-6px); box-shadow: 0 14px 40px rgba(0,0,0,0.45); }

    .label{ font-size:12px; color:var(--muted); text-transform:uppercase; letter-spacing:0.12em; }
    .value{ font-size:16px; font-weight:700; margin-top:6px; color:#e9fbf6; word-break:break-word; }

    .footer{
      text-align:center;
      color:var(--muted);
      font-size:13px;
      margin-top:6px;
    }

    /* small devices adjustments */
    @media (max-width:520px){
      .card{ padding:22px; }
      .who{ font-size:36px; }
    }
  </style>
</head>
<body>
  <main class="card center" role="main" aria-labelledby="who-title">
    <div style="position:relative;">
      <h1 id="who-title" class="who" aria-live="polite">
        <span class="typing" id="whoText" aria-hidden="true"></span>
        <span class="cursor" id="cursor" aria-hidden="true"></span>

        <!-- glitch layers -->
        <svg class="glitch" width="100%" height="100%" viewBox="0 0 100 30" preserveAspectRatio="none" aria-hidden="true">
          <text x="50%" y="60%" text-anchor="middle" dominant-baseline="middle"
            style="font-size:14px; font-weight:800; font-family:var(--font); fill:rgba(0,226,189,0.18);">
            <tspan id="g1" style="mix-blend-mode:screen; filter: blur(0.6px);">Who am I</tspan>
          </text>
        </svg>
      </h1>
    </div>

    <div class="sub" id="subline" aria-hidden="true">A subtle echo of <code>whoami</code> — discover yourself</div>

    <div class="info-grid" id="infoGrid" aria-live="polite" aria-atomic="true">
      <div class="info">
        <div class="label">Device</div>
        <div class="value" id="deviceVal">Detecting…</div>
      </div>

      <div class="info">
        <div class="label">Browser</div>
        <div class="value" id="browserVal">Detecting…</div>
      </div>

      <div class="info">
        <div class="label">Operating System</div>
        <div class="value" id="osVal">Detecting…</div>
      </div>

      <div class="info">
        <div class="label">Public IP</div>
        <div class="value" id="ipVal">Fetching…</div>
      </div>
    </div>

    <div class="footer" id="footerNote">No tracking — client-side only.</div>
  </main>

  <script>
    /* ============ Minimal customization comments ============
       - Change theme colors in the CSS :root variables at top.
       - To remove Google Font, delete the <link> tag in head and update --font.
       ======================================================= */

    // Utilities
    function safeText(s){ return String(s || '').trim(); }

    // Browser & OS detection helpers:
    function parseUserAgent(){
      const ua = navigator.userAgent || '';
      const platform = navigator.platform || '';
      const uaLow = ua.toLowerCase();

      // Prefer userAgentData if available (more privacy-aware and accurate)
      const uaData = navigator.userAgentData || null;

      // Device type heuristic
      let deviceType = 'Desktop';
      const isTouch = ('ontouchstart' in window) || navigator.maxTouchPoints > 0;
      if(/mobile|iphone|ipod|android|blackberry|iemobile|opera mini/.test(uaLow)) deviceType = 'Mobile';
      else if(/ipad|tablet/.test(uaLow)) deviceType = 'Tablet';
      else if(isTouch && ( /macintel/.test(platform.toLowerCase()) || /linux/.test(platform.toLowerCase()) )) {
        // iPadOS often reports MacIntel - treat touch MacIntel as Tablet
        deviceType = 'Tablet';
      }

      // OS detection with improved iPadOS/iOS heuristics
      let os = 'Unknown';
      if (uaLow.includes('android')) os = 'Android';
      else if (/\biphone\b/.test(uaLow) || /\bipod\b/.test(uaLow)) os = 'iOS';
      else if (/\bipad\b/.test(uaLow)) os = 'iPadOS';
      else if (/macintosh|mac os x/.test(uaLow)) {
        // Distinguish Mac vs iPadOS reporting MacIntel
        if (navigator.platform && /macintel/i.test(navigator.platform) && navigator.maxTouchPoints && navigator.maxTouchPoints > 1) {
          os = 'iPadOS';
        } else {
          os = 'macOS';
        }
      } else if (/windows nt/.test(uaLow)) os = 'Windows';
      else if (/linux/.test(uaLow)) os = 'Linux';

      // Browser detection (special care for browsers on iOS)
      let browser = 'Unknown';
      let version = '';

      // Order matters
      if (/edg\//i.test(ua)) { browser = 'Edge'; version = (ua.match(/edg\/([\d\.]+)/i)||[])[1] || ''; }
      else if (/opr\/|opera/i.test(ua)) { browser = 'Opera'; version = (ua.match(/(?:opr|opera)[\/ ]([\d\.]+)/i)||[])[1] || ''; }
      else if (/crios/i.test(ua)) { browser = 'Chrome (iOS)'; version = (ua.match(/crios\/([\d\.]+)/i)||[])[1] || ''; }
      else if (/chrome\/|chromium\//i.test(ua) && !/mobile safari/i.test(ua)) { browser = 'Chrome'; version = (ua.match(/(?:chrome|chromium)\/([\d\.]+)/i)||[])[1] || ''; }
      else if (/fxios/i.test(ua)) { browser = 'Firefox (iOS)'; version = (ua.match(/fxios\/([\d\.]+)/i)||[])[1] || ''; }
      else if (/firefox\/|fxios/i.test(ua)) { browser = 'Firefox'; version = (ua.match(/firefox\/([\d\.]+)/i)||[])[1] || ''; }
      else if (/safari/i.test(ua) && !/crios|fxios|edg|opr|chrome|chromium/i.test(ua)) { browser = 'Safari'; version = (ua.match(/version\/([\d\.]+)/i)||[])[1] || ''; }
      else if (/msie|trident/i.test(ua)) { browser = 'Internet Explorer'; version = (ua.match(/(?:msie |rv:)(\d+\.\d+)/i)||[])[1] || ''; }
      else {
        // fallback to userAgentData brands if available
        if (uaData && uaData.brands && uaData.brands.length){
          const brands = uaData.brands.map(b=>b.brand+' '+b.version).join(', ');
          browser = 'Browser ('+brands+')';
        }
      }

      // If on iOS platform but UA claims Mac, prefer iOS labeling
      if ((/iphone|ipad|ipod/.test(uaLow)) && os !== 'iOS' && os !== 'iPadOS') {
        if (/iphone/.test(uaLow)) os = 'iOS';
        else if (/ipad/.test(uaLow)) os = 'iPadOS';
      }

      // Improve Chrome detection on iOS when "Chrome" appears in vendor string or UA includes CriOS
      if (/crios/i.test(uaLow)) { browser = 'Chrome (iOS)'; version = (ua.match(/crios\/([\d\.]+)/i)||[])[1] || version; }

      // Compose readable strings
      const browserLabel = browser + (version ? ' · ' + version : '');
      return {
        ua: ua,
        platform: platform,
        deviceType: deviceType,
        browser: browserLabel,
        browserRaw: browser,
        os: os
      };
    }

    // Render helpers
    function setVal(id, txt){
      const el = document.getElementById(id);
      if(el) el.textContent = safeText(txt || 'Unknown');
    }

    // Typing + glitch animation logic
    async function runIntroSequence(onComplete){
      const whoTextEl = document.getElementById('whoText');
      const cursor = document.getElementById('cursor');

      const phrase = "Who am I";
      // Typing
      whoTextEl.textContent = '';
      cursor.style.opacity = '1';
      for(let i=0;i<=phrase.length;i++){
        whoTextEl.textContent = phrase.slice(0,i);
        await new Promise(r => setTimeout(r, 90 + Math.random()*50));
      }

      // slight pause then glitch reveal
      await new Promise(r => setTimeout(r, 260));
      // Apply brightness flicker
      const g = document.querySelector('.who .glitch');
      if(g){
        g.style.opacity = '0.18';
        // animate small horizontal jitters on the svg text elements via JS
        const t1 = document.getElementById('g1');
        if(t1){
          t1.style.animation = 'g1 0.75s linear 0s 3';
          t1.style.transformOrigin = '50% 50%';
        }
      }

      // end cursor after brief period
      await new Promise(r => setTimeout(r, 900));
      cursor.style.opacity = '0';
      if(typeof onComplete === 'function') onComplete();
    }

    // Mandatory fetch for public IP with retries
    async function fetchPublicIP(retries = 2, timeoutMs = 4000){
      const url = 'https://api.ipify.org?format=json';
      for(let attempt = 0; attempt <= retries; attempt++){
        try {
          const controller = new AbortController();
          const id = setTimeout(()=>controller.abort(), timeoutMs);
          const res = await fetch(url, { signal: controller.signal, cache: 'no-store' });
          clearTimeout(id);
          if(!res.ok) throw new Error('bad response');
          const json = await res.json();
          if(json && json.ip) return json.ip;
        } catch(err){
          // retry unless last attempt
          if(attempt === retries) {
            // Final fallback: try ipinfo.io (no token) as backup
            try {
              const ctrl2 = new AbortController();
              const id2 = setTimeout(()=>ctrl2.abort(), timeoutMs);
              const r2 = await fetch('https://ipinfo.io/json', { signal: ctrl2.signal, cache: 'no-store' });
              clearTimeout(id2);
              if(r2.ok){
                const j2 = await r2.json();
                if(j2 && j2.ip) return j2.ip;
                if(j2 && j2.city && j2.region && j2.country && j2.ip) return j2.ip;
                // some responses have 'ip' or 'ip_address' less common - last resort:
                if(j2 && j2.ip) return j2.ip;
              }
            } catch(e){}
            // If still failed, return explicit failure
            return 'Unavailable';
          }
          // small backoff
          await new Promise(r => setTimeout(r, 450 + Math.random()*300));
        }
      }
      return 'Unavailable';
    }

    // Main runner
    (async function main(){
      // start intro while we detect info and fetch IP
      const detection = parseUserAgent();

      // Start typing animation then populate card after animation ends
      runIntroSequence(async function(){
        // After intro completes, populate the entries
        setVal('deviceVal', detection.deviceType);
        setVal('browserVal', detection.browser);
        setVal('osVal', detection.os);
      });

      // Meanwhile, mandatory public IP fetch (attempt now)
      setVal('ipVal', 'Fetching…');
      const ip = await fetchPublicIP(2, 4500);
      setVal('ipVal', ip === 'Unavailable' ? 'Unavailable' : ip);

      // Accessibility: update subline for screen readers after discovery
      const sub = document.getElementById('subline');
      if(sub) sub.setAttribute('aria-hidden','false');

      // For debugging: keep UA in console (not sent anywhere)
      console.debug('whoami.nfc — detection:', { ua: navigator.userAgent, parsed: detection, ip: ip });

    })();
  </script>
</body>
</html>
