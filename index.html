<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Who am I</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;800&display=swap" rel="stylesheet">
  <style>
    :root{
      --bg:#051017; --panel:#0b1116; --accent:#00e2bd; --muted:#9aa7b3;
      --glow: 0 10px 40px rgba(0,226,189,0.08); --glass: rgba(255,255,255,0.03);
      --font: "Inter", system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
    }
    *{box-sizing:border-box} html,body{height:100%}
    body{
      margin:0; font-family:var(--font);
      background:
        radial-gradient(1200px 600px at 10% 10%, rgba(0,226,189,0.03), transparent 8%),
        radial-gradient(1000px 500px at 90% 90%, rgba(0,132,255,0.02), transparent 6%),
        var(--bg);
      color:#d6e7ee; -webkit-font-smoothing:antialiased; -moz-osx-font-smoothing:grayscale;
      display:flex; align-items:center; justify-content:center; padding:28px;
    }
    .card{
      width:100%; max-width:900px; border-radius:16px; padding:36px;
      background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
      box-shadow:var(--glow); backdrop-filter: blur(6px);
      border: 1px solid rgba(255,255,255,0.03);
      display:grid; gap:22px; align-items:center;
    }
    .center{text-align:center}

    .who{
      font-size: clamp(36px, 9vw, 84px);
      font-weight:800; letter-spacing:0.02em; line-height:0.95;
      position:relative; display:inline-block; will-change: transform, text-shadow, filter;
    }

    .who .typing{
      display:inline-block; overflow:hidden; vertical-align:middle; white-space:nowrap;
    }

    /* مؤشر الكتابة: يفضل يومض طول الوقت */
    .cursor{
      display:inline-block; width:6px; height:1.06em; background:var(--accent);
      margin-left:10px; border-radius:2px; transform: translateY(-2px);
      box-shadow: 0 0 12px rgba(0,226,189,0.8);
      animation: blink 1s steps(2,start) infinite, fadeIn 0.6s ease forwards;
    }
    @keyframes blink { 0%,100%{opacity:1} 50%{opacity:0} }
    @keyframes fadeIn { from{opacity:0} to{opacity:1} }

    /* اهتزاز ناعم دائم بعد الكتابة */
    .wiggle{ animation: floatShake 2.2s ease-in-out infinite; transform-origin:50% 60%; }
    @keyframes floatShake{
      0%{transform: translate(0,0) rotate(0)}
      20%{transform: translate(0.3px,-0.6px) rotate(-0.05deg)}
      40%{transform: translate(-0.4px,0.6px) rotate(0.06deg)}
      60%{transform: translate(0.35px,0.2px) rotate(-0.04deg)}
      80%{transform: translate(-0.25px,-0.3px) rotate(0.05deg)}
      100%{transform: translate(0,0) rotate(0)}
    }

    /* نبضة جليتش قصيرة (RGB split + jitter) */
    .glitch-burst{
      animation: glitchBurst 420ms steps(6) 1 both;
      filter: saturate(1.2) contrast(1.05);
    }
    @keyframes glitchBurst{
      0%{
        transform: translate(0,0);
        text-shadow: 0 0 0 rgba(255,0,0,0), 0 0 0 rgba(0,255,255,0);
      }
      20%{
        transform: translate(0.6px,-0.6px) skewX(0.2deg);
        text-shadow: 1px 0 rgba(255,0,0,0.6), -1px 0 rgba(0,255,255,0.6);
      }
      40%{
        transform: translate(-0.8px,0.6px) skewY(-0.2deg);
        text-shadow: 1.6px 0 rgba(255,0,0,0.5), -1.6px 0 rgba(0,255,255,0.5);
      }
      60%{
        transform: translate(0.5px,0.2px);
        text-shadow: 0.6px 0 rgba(255,0,0,0.45), -0.6px 0 rgba(0,255,255,0.45);
      }
      80%{
        transform: translate(-0.4px,-0.4px);
        text-shadow: 0.8px 0 rgba(255,0,0,0.4), -0.8px 0 rgba(0,255,255,0.4);
      }
      100%{
        transform: translate(0,0);
        text-shadow: 0 0 0 rgba(255,0,0,0), 0 0 0 rgba(0,255,255,0);
      }
    }

    /* طبقة الجليتش القديمة (SVG) */
    .who .glitch{
      position:absolute; inset:0;
      pointer-events:none; mix-blend-mode:screen; opacity:0;
      animation: glitchIn 0.9s 1 forwards;
    }
    @keyframes glitchIn{ 0%{opacity:0} 20%{opacity:1} 100%{opacity:0.18} }
    @keyframes g1 {
      0%{transform:translate(0,0)}
      20%{transform:translate(-2px,-1px)}
      40%{transform:translate(2px,1px)}
      60%{transform:translate(-1px,1px)}
      100%{transform:translate(0,0)}
    }

    .sub{ margin-top:8px; color:var(--muted); font-weight:500; letter-spacing:0.03em; }
    .info-grid{ display:grid; grid-template-columns: repeat(auto-fit, minmax(180px,1fr)); gap:14px; margin-top:12px; }
    .info{
      background:linear-gradient(180deg, rgba(255,255,255,0.012), rgba(255,255,255,0.01));
      border-radius:12px; padding:12px; border:1px solid rgba(255,255,255,0.02);
      min-height:72px; display:flex; flex-direction:column; justify-content:center;
      transition:transform .22s ease, box-shadow .22s ease;
    }
    .info:hover{ transform: translateY(-6px); box-shadow: 0 14px 40px rgba(0,0,0,0.45); }
    .label{ font-size:12px; color:var(--muted); text-transform:uppercase; letter-spacing:0.12em; }
    .value{ font-size:16px; font-weight:700; margin-top:6px; color:#e9fbf6; word-break:break-word; }
    .footer{ text-align:center; color:var(--muted); font-size:13px; margin-top:6px; }

    @media (prefers-reduced-motion: reduce){
      .wiggle{ animation:none !important }
      .glitch-burst{ animation:none !important; text-shadow:none !important; }
      .who .glitch{ animation:none !important; opacity:0.12 }
    }
    @media (max-width:520px){ .card{ padding:22px } .who{ font-size:36px } }
  </style>
</head>
<body>
  <main class="card center" role="main" aria-labelledby="who-title">
    <div style="position:relative;">
      <h1 id="who-title" class="who" aria-live="polite">
        <span class="typing" id="whoText" aria-hidden="true"></span>
        <span class="cursor" id="cursor" aria-hidden="true"></span>
        <!-- glitch layer -->
        <svg class="glitch" width="100%" height="100%" viewBox="0 0 100 30" preserveAspectRatio="none" aria-hidden="true">
          <text x="50%" y="60%" text-anchor="middle" dominant-baseline="middle"
                style="font-size:14px; font-weight:800; font-family:var(--font); fill:rgba(0,226,189,0.18);">
            <tspan id="g1" style="mix-blend-mode:screen; filter: blur(0.6px);">Who am I</tspan>
          </text>
        </svg>
      </h1>
    </div>

    <div class="sub" id="subline" aria-hidden="true">A subtle echo of <code>whoami</code> — discover yourself</div>

    <div class="info-grid" id="infoGrid" aria-live="polite" aria-atomic="true">
      <div class="info"><div class="label">Device</div><div class="value" id="deviceVal">Detecting…</div></div>
      <div class="info"><div class="label">Browser</div><div class="value" id="browserVal">Detecting…</div></div>
      <div class="info"><div class="label">Operating System</div><div class="value" id="osVal">Detecting…</div></div>
      <div class="info"><div class="label">Public IP</div><div class="value" id="ipVal">Fetching…</div></div>
    </div>

    <div class="footer" id="footerNote">No tracking — client-side only.</div>
  </main>

  <script>
    function safeText(s){ return String(s || '').trim(); }

    function parseUserAgent(){
      const ua = navigator.userAgent || '';
      const platform = navigator.platform || '';
      const uaLow = ua.toLowerCase();
      const uaData = navigator.userAgentData || null;

      let deviceType = 'Desktop';
      const isTouch = ('ontouchstart' in window) || navigator.maxTouchPoints > 0;
      if(/mobile|iphone|ipod|android|blackberry|iemobile|opera mini/.test(uaLow)) deviceType = 'Mobile';
      else if(/ipad|tablet/.test(uaLow)) deviceType = 'Tablet';
      else if(isTouch && (/macintel/.test(platform.toLowerCase()) || /linux/.test(platform.toLowerCase()))) deviceType = 'Tablet';

      let os = 'Unknown';
      if (uaLow.includes('android')) os = 'Android';
      else if (/\biphone\b/.test(uaLow) || /\bipod\b/.test(uaLow)) os = 'iOS';
      else if (/\bipad\b/.test(uaLow)) os = 'iPadOS';
      else if (/macintosh|mac os x/.test(uaLow)) {
        if (navigator.platform && /macintel/i.test(navigator.platform) && navigator.maxTouchPoints > 1) os = 'iPadOS';
        else os = 'macOS';
      } else if (/windows nt/.test(uaLow)) os = 'Windows';
      else if (/linux/.test(uaLow)) os = 'Linux';

      let browser = 'Unknown', version = '';
      if (/edg\//i.test(ua)) { browser = 'Edge'; version = (ua.match(/edg\/([\d\.]+)/i)||[])[1] || ''; }
      else if (/opr\/|opera/i.test(ua)) { browser = 'Opera'; version = (ua.match(/(?:opr|opera)[\/ ]([\d\.]+)/i)||[])[1] || ''; }
      else if (/crios/i.test(ua)) { browser = 'Chrome (iOS)'; version = (ua.match(/crios\/([\d\.]+)/i)||[])[1] || ''; }
      else if (/chrome\/|chromium\//i.test(ua) && !/mobile safari/i.test(ua)) { browser = 'Chrome'; version = (ua.match(/(?:chrome|chromium)\/([\d\.]+)/i)||[])[1] || ''; }
      else if (/fxios/i.test(ua)) { browser = 'Firefox (iOS)'; version = (ua.match(/fxios\/([\d\.]+)/i)||[])[1] || ''; }
      else if (/firefox\/|fxios/i.test(ua)) { browser = 'Firefox'; version = (ua.match(/firefox\/([\d\.]+)/i)||[])[1] || ''; }
      else if (/safari/i.test(ua) && !/crios|fxios|edg|opr|chrome|chromium/i.test(ua)) { browser = 'Safari'; version = (ua.match(/version\/([\d\.]+)/i)||[])[1] || ''; }
      else if (/msie|trident/i.test(ua)) { browser = 'Internet Explorer'; version = (ua.match(/(?:msie |rv:)(\d+\.\d+)/i)||[])[1] || ''; }
      else if (uaData && uaData.brands && uaData.brands.length){
        const brands = uaData.brands.map(b=>b.brand+' '+b.version).join(', ');
        browser = 'Browser ('+brands+')';
      }

      if ((/iphone|ipad|ipod/.test(uaLow)) && os !== 'iOS' && os !== 'iPadOS') {
        if (/iphone/.test(uaLow)) os = 'iOS'; else if (/ipad/.test(uaLow)) os = 'iPadOS';
      }
      if (/crios/i.test(uaLow)) { browser = 'Chrome (iOS)'; version = (ua.match(/crios\/([\d\.]+)/i)||[])[1] || version; }

      const browserLabel = browser + (version ? ' · ' + version : '');
      return { ua, platform, deviceType, browser: browserLabel, browserRaw: browser, os };
    }

    function setVal(id, txt){
      const el = document.getElementById(id);
      if(el) el.textContent = safeText(txt || 'Unknown');
    }

    // نبضة جليتش عشوائية كل شوية
    function startGlitchBursts(){
      const whoTextEl = document.getElementById('whoText');
      const svgTspan = document.getElementById('g1');

      function pulse(){
        // CSS glitch burst على النص الأساسي
        if(whoTextEl){
          whoTextEl.classList.add('glitch-burst');
          setTimeout(()=>whoTextEl.classList.remove('glitch-burst'), 450);
        }
        // حرك طبقة الـSVG الجليتش مرة سريعة
        if(svgTspan){
          svgTspan.style.animation = 'none';
          // force reflow لإعادة تشغيل الأنيميشن
          void svgTspan.offsetWidth;
          svgTspan.style.animation = 'g1 0.6s linear 0s 1';
          svgTspan.style.transformOrigin = '50% 50%';
        }
        scheduleNext();
      }

      function scheduleNext(){
        const delay = 2400 + Math.random()*2600; // بين ~2.4 و ~5 ثواني
        setTimeout(pulse, delay);
      }

      scheduleNext();
    }

    // كتابة + جليتش + اهتزاز + إبقاء المؤشر يومض
    async function runIntroSequence(onComplete){
      const whoTextEl = document.getElementById('whoText');
      const cursor = document.getElementById('cursor');
      const whoTitle = document.getElementById('who-title');
      const phrase = "Who am I";

      whoTextEl.textContent = '';
      // المؤشر يومض طوال الوقت بفضل CSS blink؛ لا نخفيه
      for(let i=0;i<=phrase.length;i++){
        whoTextEl.textContent = phrase.slice(0,i);
        await new Promise(r => setTimeout(r, 90 + Math.random()*50));
      }

      await new Promise(r => setTimeout(r, 260));
      const g = document.querySelector('.who .glitch');
      if(g){ g.style.opacity = '0.18'; }

      // اهتزاز مستمر خفيف
      if(whoTitle){ whoTitle.classList.add('wiggle'); }

      // ابدأ نبضات الجليتش العشوائية
      startGlitchBursts();

      if(typeof onComplete === 'function') onComplete();
    }

    async function fetchPublicIP(retries = 2, timeoutMs = 4000){
      const url = 'https://api.ipify.org?format=json';
      for(let attempt = 0; attempt <= retries; attempt++){
        try{
          const controller = new AbortController();
          const id = setTimeout(()=>controller.abort(), timeoutMs);
          const res = await fetch(url, { signal: controller.signal, cache:'no-store' });
          clearTimeout(id);
          if(!res.ok) throw new Error('bad response');
          const json = await res.json();
          if(json && json.ip) return json.ip;
        }catch(err){
          if(attempt === retries){
            try{
              const ctrl2 = new AbortController();
              const id2 = setTimeout(()=>ctrl2.abort(), timeoutMs);
              const r2 = await fetch('https://ipinfo.io/json', { signal: ctrl2.signal, cache:'no-store' });
              clearTimeout(id2);
              if(r2.ok){
                const j2 = await r2.json();
                if(j2 && j2.ip) return j2.ip;
              }
            }catch(e){}
            return 'Unavailable';
          }
          await new Promise(r => setTimeout(r, 450 + Math.random()*300));
        }
      }
      return 'Unavailable';
    }

    (async function main(){
      const detection = parseUserAgent();

      runIntroSequence(function(){
        setVal('deviceVal', detection.deviceType);
        setVal('browserVal', detection.browser);
        setVal('osVal', detection.os);
      });

      setVal('ipVal', 'Fetching…');
      const ip = await fetchPublicIP(2, 4500);
      setVal('ipVal', ip === 'Unavailable' ? 'Unavailable' : ip);

      const sub = document.getElementById('subline');
      if(sub) sub.setAttribute('aria-hidden','false');

      console.debug('whoami.nfc — detection:', { ua: navigator.userAgent, parsed: detection, ip });
    })();
  </script>
</body>
</html>
